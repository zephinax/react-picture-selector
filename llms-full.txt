# Installation Guide

React Picture Selector provides a complete solution for handling image uploads with a modern and responsive interface. It supports both drag-and-drop and traditional selection methods, offering real-time progress indication through a smooth progress ring or percentage display. Animations are optimized with `requestAnimationFrame`, ensuring fluid transitions and minimal CPU consumption even on lower-end devices. Upload operations can be safely canceled using the built-in `AbortController`, providing users with full control over the process.

## Requirements

* **Node.js 18+** (Next.js 15 and React 19 ready)
* **React 18 or 19** with concurrent rendering enabled
* Your preferred package manager (npm, pnpm, bun, or yarn)
* Optional but recommended: TypeScript for strong typings on props and `apiConfig`

<Callout type="info" title="TypeScript support">
  The package ships with TypeScript declarations so you get prop IntelliSense out of the box.
</Callout>

***

## Installation steps

<CodeBlockTabs defaultValue="npm">
  <CodeBlockTabsList>
    <CodeBlockTabsTrigger value="npm">
      npm
    </CodeBlockTabsTrigger>

    <CodeBlockTabsTrigger value="bun">
      bun
    </CodeBlockTabsTrigger>

    <CodeBlockTabsTrigger value="yarn">
      yarn
    </CodeBlockTabsTrigger>

    <CodeBlockTabsTrigger value="pnpm">
      pnpm
    </CodeBlockTabsTrigger>
  </CodeBlockTabsList>

  <CodeBlockTab value="npm">
    ```bash
    npm install react-picture-selector
    ```
  </CodeBlockTab>

  <CodeBlockTab value="bun">
    ```bash
    bun add react-picture-selector
    ```
  </CodeBlockTab>

  <CodeBlockTab value="yarn">
    ```bash
    yarn add react-picture-selector
    ```
  </CodeBlockTab>

  <CodeBlockTab value="pnpm">
    ```bash
    pnpm add react-picture-selector
    ```
  </CodeBlockTab>
</CodeBlockTabs>

## Peer dependencies

| Package     | Version | Why                                              |       |                                  |
| ----------- | ------- | ------------------------------------------------ | ----- | -------------------------------- |
| `react`     | \`^18   |                                                  | ^19\` | Core rendering primitives        |
| `react-dom` | \`^18   |                                                  | ^19\` | DOM renderer used by Next.js/CRA |
| `axios`     | `^1`    | HTTP client leveraged for upload/delete requests |       |                                  |

You can install everything at once:

```bash
npm install react-picture-selector react react-dom axios
```

<Callout type="info" title="Required dependencies">
  If your project already depends on React 18+ and Axios, you only need to install `react-picture-selector`.
</Callout>

## Project setup checklist

1. **Install the package** using the matrix above (and ensure peer deps are in place).
2. **Import the component** wherever you handle profile or gallery images.
3. **Pass `imageUrl` and `onChangeImage`** so the component stays controlled.
4. **Choose an integration mode**:
   * Provide `apiConfig` for real API calls, or
   * Enable `testMode` for mocked uploads during development.
5. **Style it** by adjusting `size`, `type`, `colors`, or `additionalClassNames`.

Once those steps are complete, the selector is production-ready.

## Basic Setup

```jsx
import PictureSelector from "react-picture-selector";
import { useState } from "react";

function ProfilePage() {
  const [currentImage, setCurrentImage] = useState("https://example.com/avatar.jpg");

  const handleImageChange = (imageUrl: string, responseData?: any) => {
    setCurrentImage(imageUrl);
    console.log("API Response:", responseData);
  };

  return (
    <PictureSelector
      imageUrl={currentImage}
      onChangeImage={handleImageChange}
      type="profile"
      title="Profile Photo"
      size={150}
    />
  );
}
```

<Callout type="success" title="Ready to Use">
   Your React Picture Selector is now installed and ready! Continue to the next section to explore advanced configuration options. 
</Callout>

## Verify your setup

1. Run your dev server (`npm run dev`) and open the page containing `PictureSelector`.
2. Click or drag an image to trigger the upload flow. In test mode, you should see the progress ring animate to 100%.
3. Switch `testMode` off and provide an `apiConfig` to confirm real network requests succeed.
4. Trigger deletions to ensure your backend receives the correct HTTP method and body.

<Callout type="warning" title="Common gotchas">
  * Always return a URL in your upload response at the path specified by `responsePath`.
  * When using Next.js app router, keep the component on the client (e.g., `use client`) because it relies on browser APIs.
  * If your API relies on cookies/sessions, set `withCredentials` to `true` and configure CORS to allow credentialed requests.
</Callout>


# API and Styling

The `apiConfig` prop allows you to specify endpoints, HTTP methods, headers, and callbacks for upload and delete operations.

## API Configuration Interface

```typescript
interface ApiConfig {
  // Required URLs
  deleteUrl: string;        // Path for deleting images, combined with baseUrl
  uploadUrl: string;        // Path for uploading images, combined with baseUrl
  baseUrl: string;          // Base URL for API requests

  // Optional Configuration
  responsePath?: string;    // Path to extract image URL from API response (default: "data.data")
  formDataName?: string;    // Name of the file field in FormData (default: "file")
  additionalHeaders?: Record<string, string>; // Deprecated: shared headers for upload/delete
  uploadHeaders?: Record<string, string>; // Upload-only headers
  deleteHeaders?: Record<string, string>; // Delete-only headers
  withCredentials?: boolean; // Send cookies/credentials on upload/delete requests

  // HTTP Methods
  uploadMethod?: "POST" | "PUT" | "PATCH";  // HTTP method for upload requests
  deleteMethod?: "POST" | "DELETE" | "PUT"; // HTTP method for delete requests

  // Request Body
  deleteBody?: Record<string, unknown> | ((imageUrl: string) => Record<string, unknown>);

  // Event Callbacks
  onUploadSuccess?: (url: string) => void;
  onUploadError?: (error: any) => void;
  onDeleteStart?: () => void;
  onDeleteSuccess?: () => void;
}
```

### Lifecycle events

1. **User selects a file** ‚Äì the component builds `FormData` using `formDataName` and fires `onDeleteStart` if a delete needs to happen first.
2. **Upload request** ‚Äì a `fetch` powered by Axios is sent to `baseUrl + uploadUrl` with your headers and method.
3. **Progress + preview** ‚Äì live progress is emitted while bytes stream in; fallback animations kick in when `Content-Length` is missing.
4. **Success** ‚Äì the response body is parsed, the image URL is extracted via `responsePath`, and `onUploadSuccess` plus `onChangeImage` fire.
5. **Failure** ‚Äì `onUploadError` runs and the UI resets the component so users can retry immediately.

<Callout type="info" title="Abort handling">
  Deletions follow the same pattern but call `deleteUrl` with `deleteBody`. If a user cancels mid-flight, the Axios request is aborted and cleanup callbacks still trigger.
</Callout>

## Complete API Configuration Example

<CodeBlockTabs defaultValue="full">
  <CodeBlockTabsList>
    <CodeBlockTabsTrigger value="full">
      Full Configuration
    </CodeBlockTabsTrigger>

    <CodeBlockTabsTrigger value="minimal">
      Minimal Setup
    </CodeBlockTabsTrigger>

    <CodeBlockTabsTrigger value="auth">
      With Authentication
    </CodeBlockTabsTrigger>
  </CodeBlockTabsList>

  <CodeBlockTab value="full">
    ```jsx
    const apiConfig = {
      baseUrl: "https://api.example.com",
      uploadUrl: "/upload",
      deleteUrl: "/images/remove",
      withCredentials: true,
      formDataName: "profile_picture",
      responsePath: "data.imageUrl",
      additionalHeaders: {
        "X-API-Key": "your-api-key",
        "Client-Version": "1.0.0"
      },
      uploadHeaders: {
        "Content-Type": "multipart/form-data"
      },
      deleteHeaders: {
        "Content-Type": "application/json"
      },
      uploadMethod: "POST",
      deleteMethod: "DELETE",
      deleteBody: (imageUrl) => ({
        imageId: imageUrl.split("/").pop(),
        timestamp: Date.now()
      }),
      onUploadSuccess: (url) => console.log("Uploaded:", url),
      onUploadError: (error) => console.error("Upload failed:", error),
      onDeleteStart: () => console.log("Starting deletion..."),
      onDeleteSuccess: () => console.log("Image deleted successfully")
    };
    ```
  </CodeBlockTab>

  <CodeBlockTab value="minimal">
    ```jsx
    const apiConfig = {
      baseUrl: "https://api.example.com",
      uploadUrl: "/upload",
      deleteUrl: "/delete",
      uploadMethod: "POST",
      deleteMethod: "POST"
    };
    ```
  </CodeBlockTab>

  <CodeBlockTab value="auth">
    ```jsx
    const apiConfig = {
      baseUrl: "https://api.example.com",
      uploadUrl: "/v1/images/upload",
      deleteUrl: "/v1/images/delete",
      withCredentials: true,
      additionalHeaders: {
        Authorization: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "X-Client-ID": "your-client-id"
      },
      uploadHeaders: {
        "Content-Type": "multipart/form-data"
      },
      deleteHeaders: {
        "Content-Type": "application/json"
      },
      deleteBody: {
        permanent: true,
        reason: "user_requested"
      }
    };
    ```
  </CodeBlockTab>
</CodeBlockTabs>

<Callout type="info" title="API Requirements">
  Your API should support:

  * **Upload**: Accept `multipart/form-data` with the file attached
  * **Delete**: Accept requests with customizable method and body
  * **Response**: Return the image URL in the specified `responsePath`
  * **Credentials (optional)**: If you rely on session cookies, set `withCredentials: true` and configure CORS to allow credentialed requests.
</Callout>

## Debug mode

Set `debug` on the component to log upload/delete lifecycle events to the console (authorization headers are redacted).

## Handling responses

* `responsePath` uses lodash-style dot notation (default: `data.data`). Update it when your backend wraps URLs differently (e.g., `result.payload.url`).
* `deleteBody` can be a plain object or a callback that receives the previously stored `imageUrl`. This is handy when your API expects an image ID or signed key extracted from the URL itself.
* Every successful upload triggers `onChangeImage(url, responseBody)` so you can store extra metadata (S3 keys, CDN hashes, etc.) alongside the URL.

```ts
const apiConfig: ApiConfig = {
  baseUrl: "https://api.example.com",
  uploadUrl: "/media",
  deleteUrl: "/media/delete",
  responsePath: "result.assets[0].cdnUrl",
  deleteBody: (imageUrl) => ({ assetId: new URL(imageUrl).searchParams.get("id") })
};
```

<Callout type="warning" title="Error visibility">
  Wrap network errors in logging/monitoring on your side via `onUploadError` so you know when a user cannot upload because of auth or quota issues.
</Callout>

## Test mode behavior

* Set `testMode` to `true` when you want the component to bypass HTTP calls and simulate uploads locally.
* The component still fires `onChangeImage`, letting the rest of your UI react as though a real upload completed.
* Deletions resolve instantly in test mode, which is useful for unit tests or live demos where you do not have API credentials available.

<Callout type="info" title="Switching between modes">
  You can leave `apiConfig` defined while toggling `testMode`. When `testMode` is `true`, network calls are skipped; when it is `false`, the same component immediately starts using your backend.
</Callout>

***

## Styling & Customization

Color Palette Configuration:

```typescript
interface ColorPalette {
  primary: string;      // Edit button background color
  error: string;        // Delete button background color
  progress: string;     // Progress ring/percentage color
  placeholder: string;  // Placeholder SVG color
  text: string;         // Progress percentage text color
  textDisabled: string; // Disabled button text/icon color
}
```

Class name slots:

```typescript
interface SelectorClassNames {
  title?: string;
  titleContainer?: string;
  edit?: string;
  delete?: string;
  image?: string;
  progressText?: string;
  previewButton?: string;
}
```

Use `colors` for token-level changes and `additionalClassNames` when you need to plug in utility classes, design-system tokens, or CSS modules.

## Styling Examples

<CodeBlockTabs defaultValue="color">
  <CodeBlockTabsList>
    <CodeBlockTabsTrigger value="color">
      Color Schemes
    </CodeBlockTabsTrigger>

    <CodeBlockTabsTrigger value="class">
      Custom Classes
    </CodeBlockTabsTrigger>

    <CodeBlockTabsTrigger value="complete">
      Complete Example
    </CodeBlockTabsTrigger>
  </CodeBlockTabsList>

  <CodeBlockTab value="color">
    ```jsx
    // Modern Blue Theme
    const colors = {
      primary: "#3B82F6",
      error: "#EF4444",
      progress: "#10B981",
      placeholder: "#9CA3AF",
      text: "#FFFFFF",
      textDisabled: "#D1D5DB"
    };

    // Dark Theme
    const darkColors = {
      primary: "#8B5CF6",
      error: "#F43F5E",
      progress: "#06D6A0",
      placeholder: "#6B7280",
      text: "#1F2937",
      textDisabled: "#4B5563"
    };
    ```
  </CodeBlockTab>

  <CodeBlockTab value="class">
    ```jsx
    const additionalClassNames = {
      title: "font-bold text-lg mb-2",
      titleContainer: "border-b pb-2 mb-4",
      delete: "hover:scale-110 transition-transform",
      edit: "shadow-lg hover:shadow-xl",
      image: "rounded-xl border-2 border-gray-200"
    };

    // Usage
    <PictureSelector
      additionalClassNames={additionalClassNames}
      // ... other props
    />
    ```
  </CodeBlockTab>

  <CodeBlockTab value="complete">
    ```jsx
    const stylingConfig = {
      colors: {
        primary: "#1E90FF",
        error: "#FF0000",
        progress: "#FF69B4",
        placeholder: "#A9A9A9",
        text: "#FFFFFF",
        textDisabled: "#D3D3D3"
      },
      additionalClassNames: {
        title: "text-purple-900 font-semibold",
        titleContainer: "bg-gray-50 px-4 py-2 rounded-t-lg",
        delete: "hover:bg-red-600 transition-colors",
        edit: "hover:bg-blue-600 transition-colors",
        image: "shadow-md hover:shadow-lg transition-shadow"
      }
    };

    <PictureSelector
      {...stylingConfig}
      type="profile"
      size={200}
      showProgressRing={true}
      blurOnProgress={true}
    />
    ```
  </CodeBlockTab>
</CodeBlockTabs>

### Styling tips

* Pair `size` with CSS clamp/utility classes to adapt to small vs. large breakpoints.
* Combine `additionalClassNames.image` with aspect-ratio utilities when embedding into card layouts.
* Keep brand colors accessible: `progress` and `text` should pass WCAG AA against the button background.
* Enable `blurOnProgress` when replacing an existing avatar so users understand a change is in flight.

***

## Component Types & Sizes

<Cards>
  <Card title="Profile Type" description="Circular image with ring progress indicator. Ideal for user avatars and profile pictures." />

  <Card title="Rectangle Type" description="Rectangular image with percentage progress bar. Perfect for general image uploads." />
</Cards>

```jsx
// Profile (Circular)
<PictureSelector type="profile" size={150} />

// Rectangle
<PictureSelector type="rectangle" size={200} />
```

<Callout type="success" title="Tailwind CSS Compatible">
   The component uses Tailwind CSS classes by default, but you can override any style using the color palette and additionalClassNames props. 
</Callout>


# Introduction

<p align="center">
  <img src="https://raw.githubusercontent.com/Zephinax/react-picture-selector/refs/heads/dev/public/circle.gif" alt="Profile Picture Upload Animation" width="200" />
</p>

The `PictureSelector` component is a highly customizable React component designed for seamless image upload, deletion, and preview functionality, ideal for profile pictures or general image management. Use it when you want to ship a polished upload experience without rebuilding drag & drop, preview modals, or API wiring from scratch.

<Cards>
  <Card title="üöÄ Feature Rich" description="Drag & drop, progress indicators, preview modals, and API integration" href="#features" />

  <Card title="üé® Highly Customizable" description="Colors, sizes, shapes, and full CSS class control" href="#styling" />

  <Card title="üß™ Test Mode" description="Simulate uploads and deletions without API dependencies" href="#test-mode" />

  <Card title="‚ö° Performance Optimized" description="Smooth animations with requestAnimationFrame and abort controllers" href="#features" />
</Cards>

***

## Features

* **Smooth Image Upload**: Upload images with a progress ring (for profiles) or percentage display, powered by `requestAnimationFrame` for smooth animations and low CPU usage.
* **Flexible Image Deletion**: Delete images via API with customizable HTTP methods, headers, and request body, or simulated deletion in test mode.
* **Progress Indicator**: Displays a progress ring for circular profiles or a percentage-based indicator, with non-linear fallback for servers without `Content-Length`.
* **Drag and Drop Support**: Allows users to drag and drop images with visual feedback, with prevention of dragging selected photos for better UX.
* **Image Preview**: Clickable modal preview for uploaded images, supporting circular and rectangular formats.
* **Full API Response Access**: Provides the full API response body as an optional parameter in `onChangeImage` for advanced use cases.
* **Configurable Styling**: Customize colors, sizes, shapes, and additional CSS classes for full control over appearance.
* **Abort Controller**: Cancel ongoing uploads using `AbortController` for better user control.
* **Event Callbacks**: Support for `onUploadSuccess`, `onUploadError`, `onDeleteStart`, and `onDeleteSuccess` callbacks to handle upload and deletion events.
* **Test Mode**: Simulate uploads and deletions with configurable delays, ideal for testing without API dependencies.
* **Debug Logging**: Toggle verbose upload/delete lifecycle logs with a `debug` prop.
* **Responsive Design**: Supports RTL layouts, responsive sizing, and both circular (profile) and rectangular image types.
* **Robust Error Handling**: Displays clear error messages for failed operations, with proper cleanup to prevent resource leaks.
* **Performance Optimizations**: Prevents race conditions, ensures clean percentage displays, and optimizes resource usage using `useMemo` and `useCallback`.

***

## Quick Start

<CodeBlockTabs defaultValue="basic">
  <CodeBlockTabsList>
    <CodeBlockTabsTrigger value="basic">
      Basic Usage
    </CodeBlockTabsTrigger>

    <CodeBlockTabsTrigger value="advanced">
      Advanced Configuration
    </CodeBlockTabsTrigger>
  </CodeBlockTabsList>

  <CodeBlockTab value="basic">
    ```jsx
    import PictureSelector from "react-picture-selector";

    const App = () => {
      const handleImageChange = (imageUrl: string, responseData?: unknown) => {
        console.log("New image URL:", imageUrl, responseData);
      };

      return (
        <PictureSelector
          imageUrl="https://example.com/avatar.jpg"
          onChangeImage={handleImageChange}
          type="profile"
          title="Profile Picture"
          size={180}
        />
      );
    };
    ```
  </CodeBlockTab>

  <CodeBlockTab value="advanced">
    ```jsx
    import PictureSelector from "react-picture-selector";

    const App = () => {
      const handleImageChange = (imageUrl: string, responseData?: any) => {
        console.log("Image changed:", imageUrl, responseData);
      };

      const apiConfig = {
        baseUrl: "https://api.example.com",
        uploadUrl: "/upload",
        deleteUrl: "/remove/123",
        withCredentials: true,
        formDataName: "image",
        additionalHeaders: {
          Authorization: "Bearer your-token",
        },
        uploadHeaders: {
          "Content-Type": "multipart/form-data",
        },
        deleteHeaders: {
          "Content-Type": "application/json",
        },
        uploadMethod: "POST",
        deleteMethod: "DELETE",
      };

      return (
        <PictureSelector
          apiConfig={apiConfig}
          imageUrl="https://example.com/avatar.jpg"
          onChangeImage={handleImageChange}
          type="profile"
          title="User Avatar"
          size={200}
          testMode={false}
          debug={false}
        />
      );
    };
    ```
  </CodeBlockTab>
</CodeBlockTabs>

***

## Core Concepts

### Upload experience

* **Drop zone and picker**: Users can drag files onto the selector or open the OS picker. When an upload is running, the drop zone is visually disabled to prevent duplicate requests.
* **Abortable progress**: Uploads use `AbortController`, so canceling, deleting, or navigating away halts the request and resets progress cleanly.
* **Accessible previews**: The preview modal is keyboard navigable, traps focus, and adapts to both circular (‚Äúprofile‚Äù) and rectangular image modes.

### Test mode vs real mode

* **Test mode** simulates uploads and deletions locally. It is perfect for Storybook, design reviews, or rapid prototyping without a backend.
* **Real mode** sends HTTP requests described in `apiConfig`. You receive the resulting URL and the raw API response via `onChangeImage` so nothing is lost.

<Callout type="info" title="State management">
  `PictureSelector` is stateless; you control the `imageUrl` prop. Update your local or server state when `onChangeImage` fires to keep the UI in sync.
</Callout>

***

## Props overview

| Prop                   | Type                                        | Required | Description                                                                |
| ---------------------- | ------------------------------------------- | -------- | -------------------------------------------------------------------------- |
| `imageUrl`             | `string`                                    | ‚úÖ        | Current image shown in the selector or placeholder if empty                |
| `title`                | `string`                                    | ‚úÖ        | Title rendered above the selector (and announced for accessibility)        |
| `type`                 | `"profile" \| "image"`                      | ‚úÖ        | Controls layout, aspect ratio, and progress indicator style                |
| `size`                 | `number`                                    | ‚úÖ        | Base dimension in pixels for the component                                 |
| `onChangeImage`        | `(url: string, response?: unknown) => void` | ‚úÖ        | Fires after upload/delete so you can persist state                         |
| `apiConfig`            | `ApiConfig`                                 | ‚ùå        | Enables real upload/delete requests with headers and callbacks             |
| `testMode`             | `boolean`                                   | ‚ùå        | Forces simulated uploads with configurable delays                          |
| `colors`               | `ColorPalette`                              | ‚ùå        | Overrides primary/error/progress/placeholder/text colors                   |
| `additionalClassNames` | `SelectorClassNames`                        | ‚ùå        | Granular class overrides for title, buttons, or image shell                |
| `showProgressRing`     | `boolean`                                   | ‚ùå        | Toggles the radial indicator for profile images                            |
| `blurOnProgress`       | `boolean`                                   | ‚ùå        | Blurs the current photo while uploads run to hint a change                 |
| `debug`                | `boolean`                                   | ‚ùå        | Logs upload/delete lifecycle details to the console (redacts auth headers) |

***

## Testing scenarios

| Scenario                   | Recommendation                                                                              |
| -------------------------- | ------------------------------------------------------------------------------------------- |
| Designing UI states        | Enable `testMode`, adjust delays, and preview empty vs filled selectors                     |
| Integrating with a backend | Start in test mode to wire callbacks, then add `apiConfig` and monitor network traffic      |
| Handling errors            | Force a rejection in test mode or point to a known failing endpoint to confirm the error UI |
| RTL layouts                | Wrap the component in `<div dir="rtl">` to verify spacing, focus, and animation direction   |

***

## Next steps

* Head to [Installation](./02-installation) for environment requirements and peer dependencies.
* Dive into [API & Styling](./03-api-and-styling) to configure uploads, callbacks, and themes.
* Ready to contribute? The root `README` documents scripts, linting, and deployment commands.
